parameters.html{% extends "gcampuscore/base.html" %}
{% load i18n static %}
{% block title %}
    {% translate "Add Parameters" %}
{% endblock %}
{% block body_class %}bg-light{% endblock %}
{% block navbar_title %}{% endblock %}
{% block navbar_other %}
    <ul class="nav navbar-nav me-auto">
        {% translate "1. Metadata" as metadata_title %}
        {% translate "2. Measured Parameters" as chemical_parameters_title %}
        {% translate "3. Saprobic Abundancies" as biological_parameters_title %}
        {% translate "4. Structural Assessment" as structure_index_title %}

        {% url "gcampuscore:edit-measurement" pk=object.pk as edit_url %}
        {% include "gcampuscore/components/nav_item.html" with url=edit_url title=metadata_title view_name="gcampuscore:edit-measurement" %}

        {% if request.resolver_match.view_name == "gcampuscore:edit-chemical-parameters" %}
            {% url "gcampuscore:edit-chemical-parameters" pk=object.pk as chemical_parameter_url %}
            {% include "gcampuscore/components/nav_item.html" with url=chemical_parameter_url title=chemical_parameters_title view_name="gcampuscore:edit-chemical-parameters" %}
        {% else %}
            {% url "gcampuscore:add-chemical-parameters" pk=object.pk as chemical_parameter_url %}
            {% include "gcampuscore/components/nav_item.html" with url=chemical_parameter_url title=chemical_parameters_title view_name="gcampuscore:add-chemical-parameters" %}
        {% endif %}

        {% url "gcampuscore:edit-biological-parameters" pk=object.pk as biological_parameter_url %}
        {% include "gcampuscore/components/nav_item.html" with url=biological_parameter_url title=biological_parameters_title view_name="gcampuscore:edit-biological-parameters" %}

        {% url "gcampuscore:edit-structure-index" pk=object.pk as structure_index_url %}
        {% include "gcampuscore/components/nav_item.html" with url=structure_index_url title=structure_index_title view_name="gcampuscore:edit-structure-index" %}
    </ul>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row justify-content-center">
            <div class="col col-lg-10">
                <form method="POST" class="py-3">
                    <h4><label class="mb-2">{% translate "Parameters" %}</label></h4>
                    <div class="text-danger">
                        {% for error in formset.non_form_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    <div class="mb-3 box box-info">
                        <div class="my-2">
                            {% include "gcampuscore/icons/info-circle-fill.html" with extra_class="flex-shrink-0 me-1" %}
                            {% translate "Convert each optical density into the concentration of the parameter you measured and document the resulting value here. Use the note field to describe your procedure in the case you deviated from the standard protocoll." %}
                        </div>
                    </div>
                    {% csrf_token %}
                    {% for field in formset.management_form %}
                        {% comment %}
                        This is used instead of {{ formset.management_form }}
                        to hide errors coming from the management form.
                        {% endcomment %}
                        {{ field }}
                    {% endfor %}
                    <ul class="list-group list-group-spaced"
                        id="id_{{ formset.prefix }}-FORM-CONTAINER">
                        {% for form in formset %}
                            {% include "gcampuscore/forms/components/parameter_form.html" with form=form show=True only %}
                        {% endfor %}
                        {% include "gcampuscore/forms/components/parameter_form.html" with form=formset.empty_form formset=formset show=True overlay=True only %}
                    </ul>
                    <div class="mt-3 w-100 align-items-end d-flex">
                        <a href="." class="ms-auto btn btn-secondary btn-block">
                            {% translate "Discard" %}
                        </a>
                        <button type="submit"
                                class="ms-2 btn btn-primary btn-block">
                            {% translate "Save" %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <template id="id_{{ formset.prefix }}-EMPTY_FORM_TEMPLATE">
        {% include "gcampuscore/forms/components/parameter_form.html" with form=formset.empty_form show=False only %}
    </template>
{% endblock %}
{% block extra_body %}
    <script type="text/javascript" src="{% static 'gcampuscore/js/dynamicformset.js' %}"></script>
    <script type="text/javascript">
        window.addEventListener('load', () => {
            let formset = new gcampuscore.dynamicformset.DynamicFormset("{{ formset.prefix }}");
        });
    </script>
{% endblock %}
