{% extends "gcampuscore/base.html" %}
{% load i18n auth_token icon static %}
{% block modals %}
    {{ block.super }}
    <div class="modal fade"
         id="editModal"
         tabindex="-1"
         aria-labelledby="editModal"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModal">
                        {% translate "Edit course data" %}
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="POST">
                        {% csrf_token %}
                        {% auth_token %}
                        {% with field=form.school_name %}
                            <div class="mb-3">
                                {% include "gcampuscore/forms/components/label.html" with class="mb-2" %}
                                {% include "gcampuscore/forms/components/helptext.html" %}
                                {% include "gcampuscore/forms/widgets/input.html" with widget=field.subwidgets.0.data %}
                            </div>
                        {% endwith %}
                        {% with field=form.token_name %}
                            <div class="mb-3">
                                {% include "gcampuscore/forms/components/label.html" with class="mb-2" %}
                                {% include "gcampuscore/forms/components/helptext.html" %}
                                {% include "gcampuscore/forms/widgets/input.html" with widget=field.subwidgets.0.data %}
                            </div>
                        {% endwith %}
                        {% with field=form.teacher_name %}
                            <div class="mb-3">
                                {% include "gcampuscore/forms/components/label.html" with class="mb-2" %}
                                {% include "gcampuscore/forms/components/helptext.html" %}
                                {% include "gcampuscore/forms/widgets/input.html" with widget=field.subwidgets.0.data %}
                            </div>
                        {% endwith %}
                        {% with field=form.teacher_email %}
                            <div class="mb-3">
                                {% include "gcampuscore/forms/components/label.html" with class="mb-2" %}
                                {% include "gcampuscore/forms/components/helptext.html" %}
                                {% include "gcampuscore/forms/widgets/input.html" with widget=field.subwidgets.0.data %}
                            </div>
                        {% endwith %}
                        <div class="modal-footer">
                            <button type="button" class="btn" data-bs-dismiss="modal">
                                {% translate "Close" %}
                            </button>
                            <button class="btn btn-primary">
                                {% translate "Save" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block content %}
    <!-- Nav tabs -->
    <div class="container-fluid mb-2">
        <ul class="nav nav-tabs tab-top" id="Tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="course-data-tab" data-bs-toggle="tab" data-bs-target="#course-data"
                        type="button" role="tab" aria-controls="course-data"
                        aria-selected="true">
                    {% translate "Course data" %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="access-keys-tab" data-bs-toggle="tab" data-bs-target="#access-keys"
                        type="button" role="tab" aria-controls="access-keys"
                        aria-selected="false">
                    {% translate "Access keys" %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents"
                        type="button"
                        role="tab" aria-controls="documents" aria-selected="false">
                    {% translate "Documents" %}
                </button>
            </li>
        </ul>
    </div>

    <!-- Tab panes -->
    <div class="tab-content mt-5">

        <div class="tab-pane active" id="course-data" role="tabpanel" aria-labelledby="course-data-tab">
            <div class="container-fluid mt-4" id="course-data">
                <div class="row mt-4">
                    <div class="col-lg-7">
                        <h6>{% translate "Course token" %}</h6>
                        <h3 class="fw-normal">
                            {% displaytoken form.instance.token hidden=True toggle=True %}
                        </h3>
                    </div>
                    <div class="col-lg-5">
                        {% blocktranslate trimmed %}
                            With this <b>course token</b>, you can manage your
                            course and edit your student's measurements. Thus,
                            this key should be kept private.
                        {% endblocktranslate %}
                    </div>
                </div>

                <div class="mt-4">
                    <h6>{% translate "School Name" %}</h6>
                    <h4 class="fw-normal">
                        {% if form.instance.school_name %}
                            {{ form.instance.school_name }}
                        {% else %}
                            {% translate "N/A" context "no value provided (water name, comment, etc)" %}
                        {% endif %}
                    </h4>
                </div>

                <div class="mt-4">
                    <h6>{% translate "Course Name" %}</h6>
                    <h4 class="fw-normal">
                        {% if form.instance.token_name %}
                            {{ form.instance.token_name }}
                        {% else %}
                            {% translate "N/A" context "no value provided (water name, comment, etc)" %}
                        {% endif %}
                    </h4>
                </div>

                <div class="mt-4">
                    <h6>{% translate "Teacher Name" %}</h6>
                    <h4 class="fw-normal">
                        {% if form.instance.teacher_name %}
                            {{ form.instance.teacher_name }}
                        {% else %}
                            {% translate "N/A" context "no value provided (water name, comment, etc)" %}
                        {% endif %}
                    </h4>
                </div>

                <button type="button" id="guide02anchor" class="btn btn-secondary mt-4 float-end" data-bs-toggle="modal"
                        data-bs-target="#editModal">
                    {% translate "Edit" %}
                </button>

                <div class="mt-4">
                    <h6>{% translate "email" %}</h6>
                    <h4 class="fw-normal">
                        {% if form.instance.teacher_email %}
                            {{ form.instance.teacher_email }}
                        {% else %}
                            {% translate "N/A" context "no value provided (water name, comment, etc)" %}
                        {% endif %}
                    </h4>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="access-keys" role="tabpanel" aria-labelledby="access-keys-tab">
            <div class="container-fluid mt-4">
                <h6>{% translate "Generate new Access keys for this course" %}</h6>
                <small class="text-sm text-muted">
                    {% blocktrans trimmed %}
                        You can generate new access keys for this course without
                        the need to register again. The number of access keys is
                        limited to {{ register_max_access_key }} per course.
                    {% endblocktrans %}
                </small>
                <form class="mt-2" method="post" action="{% url "gcampusauth:generate-new-access-keys" %}">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-auto">
                            {% with field=generate_accesskeys_form.count %}
                                {% include "gcampuscore/forms/widgets/input.html" with widget=field.subwidgets.0.data %}
                            {% endwith %}
                        </div>
                        <div class="col-auto">
                            <button type="submit" class="btn btn-secondary" id="guide03anchor">
                                {% translate "Generate access keys" %}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="container-fluid mt-5">
                <h6>{% translate "List of all access keys of this course" %}</h6>
                <div class="list-group mt-4">
                    {% for access_key in access_keys %}
                        {% include "gcampusauth/components/access_key_item.html" with access_key=access_key counter=forloop.counter %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="tab-pane" id="documents" role="tabpanel" aria-labelledby="documents-tab">
            <div class="container-fluid mt-4">
                <div class="row align-items-center mt-4">
                    <div class="col-10">
                        <h5>{% translate "Save course overview" %}</h5>
                        <div class="text-sm text-muted">
                            {% blocktrans trimmed %}
                                Download a PDF with a summary of your registration
                                data, your course token, and the all access keys
                                of your course.
                            {% endblocktrans %}
                        </div>
                    </div>
                    <div class="col-2">
                        <a class="btn btn-secondary me-2 float-end"
                           href="{% url "gcampusdocuments:documents-overview" %}"
                           role="link">
                            {% icon "download" class="d-inline-block align-text-top" height="16" width="16" %}
                            &nbsp;
                            {% translate "Download PDF" %}
                        </a>
                    </div>
                </div>

                <hr class="my-4">

                <div class="row align-items-center">
                    <div class="col-10">
                        <h5>{% translate "Save access keys" %}</h5>
                        <div class="text-sm text-muted">
                            {% blocktrans trimmed %}
                                Download a PDF with all access keys
                                (one key per page/student)
                                of your course with instructions for your students.
                            {% endblocktrans %}
                        </div>
                    </div>
                    <div class="col-2">
                        <a class="btn btn-secondary me-2 float-end"
                           href="{% url "gcampusdocuments:accesskey-combined" %}"
                           role="link">
                            {% icon "download" class="d-inline-block align-text-top" height="16" width="16" %}
                            &nbsp;
                            {% translate "Download PDF" %}
                        </a>
                    </div>
                </div>

                <hr class="my-4">

                <div class="row align-items-center">
                    <div class="col-10">
                        <h5>{% translate "Send to my email" %}</h5>
                        <div class="text-sm text-muted">
                            {% blocktrans trimmed with course_data_url="#course-data" %}
                                Send your course token and all access keys in a PDF
                                via email. You can change your email address in the
                                course data tab.
                            {% endblocktrans %}
                        </div>
                    </div>
                    <div class="col-2">
                        <a class="btn btn-secondary me-2 float-end"
                           href="#" {# TODO: generate PDF and send email  #}
                           role="link">
                            {% icon "mail" class="d-inline-block align-text-top" height="16" width="16" %} &nbsp;
                            {% translate "Send email" %}
                        </a>
                    </div>
                </div>

            </div>
        </div>

    </div>

    {% include "gcampusauth/components/guide.html" %}

    <script type="text/javascript" src="{% static 'gcampuscore/js/main.js' %}"></script>
    <script>
        var triggerTabList = [].slice.call(document.querySelectorAll('#myTab a'))
        triggerTabList.forEach(function (triggerEl) {
            var tabTrigger = new gcampuscore["main"].Tab(triggerEl)
            triggerEl.addEventListener('click', function (event) {
                event.preventDefault()
                tabTrigger.show()
            })
        })

        var guide01options = {
            content: document.getElementById("guide01").innerHTML,
            customClass: 'guide-popover', trigger: "manual", html: true, sanitize: false
        }
        var guide01anchor = document.getElementById('guide01anchor')
        var guide01 = new gcampuscore["main"].Popover(guide01anchor, guide01options)

        var guide02options = {
            content: document.getElementById("guide02").innerHTML,
            customClass: 'guide-popover', trigger: "manual", html: true, sanitize: false
        }
        var guide02anchor = document.getElementById('guide02anchor')
        var guide02 = new gcampuscore["main"].Popover(guide02anchor, guide02options)

        var guide03options = {
            content: document.getElementById("guide03").innerHTML,
            customClass: 'guide-popover', trigger: "manual", html: true, sanitize: false
        }
        var guide03anchor = document.getElementById('guide03anchor')
        var guide03 = new gcampuscore["main"].Popover(guide03anchor, guide03options)

        function startGuide() {
            document.getElementById("guideOverlay").style.display = "block";
            guide01.show();
        }

        function continueWithGuide02() {
            guide01.hide();
            guide02.show();
        }

        function continueWithGuide03() {
            guide02.hide();
            guide03.show();
        }

        function endGuide() {
            guide01.hide();
            guide02.hide();
            guide03.hide();
            document.getElementById("guideOverlay").style.display = "none";
        }

    </script>

    {% displaytoken_js %}
{% endblock %}
